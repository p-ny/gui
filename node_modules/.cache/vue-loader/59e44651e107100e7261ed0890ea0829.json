{"remainingRequest":"D:\\downloads\\UNIQ\\Gui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\downloads\\UNIQ\\Gui\\src\\views\\NewDonateShop\\Roulette\\Game.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"D:\\downloads\\UNIQ\\Gui\\src\\views\\NewDonateShop\\Roulette\\Game.vue","mtime":1625151238078},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\css-loader\\dist\\cjs.js","mtime":1685190019100},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1685190024220},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\postcss-loader\\src\\index.js","mtime":1685190021333},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1685190017369},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1685190017390},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\vue-loader\\lib\\index.js","mtime":1685190022137}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoubmV3ZHNob3Atcm91bGwtZ2FtZXsKICAgIHdpZHRoOiA4MHJlbTsKICAgIGFsaWduLXNlbGY6IGZsZXgtc3RhcnQ7CiAgICBtYXJnaW4tdG9wOiAxLjVyZW07CiAgICAmX3N1YnRpdGxlewogICAgICAgIG1hcmdpbi10b3A6IDNyZW07CiAgICAgICAgZm9udC1zaXplOiAuOHJlbTsKICAgICAgICBjb2xvcjogcmdiYSgjZmZmLCAuNSk7CiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgfQogICAgJl90aXRsZXsKICAgICAgICBmb250LXNpemU6IDMuNXJlbTsKICAgICAgICBmb250LXdlaWdodDogNzAwOwogICAgICAgIGxldHRlci1zcGFjaW5nOiAuMDdyZW07CiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgIG1hcmdpbi1ib3R0b206IDRyZW07CiAgICAgICAgdGV4dC1zaGFkb3c6IDAgMCAuOHJlbSByZ2JhKCNmZmYsIC43KTsKICAgIH0KICAgICZfdG9wewogICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIH0KICAgICZfYm90dG9tewogICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgxODBkZWcpOwogICAgfQogICAgJi1idXR0b257CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzRCOEE5RTsKICAgICAgICB3aWR0aDogMTAuN3JlbTsKICAgICAgICBtYXJnaW46IDNyZW0gYXV0bzsKICAgICAgICBib3JkZXItcmFkaXVzOiAuMnJlbTsKICAgICAgICB0cmFuc2Zvcm06IHNrZXcoLTEwZGVnKTsKICAgICAgICAmX2NvbnRhaW5lcnsKICAgICAgICAgICAgaGVpZ2h0OiAzcmVtOwogICAgICAgICAgICB3aWR0aDogMTAuN3JlbTsKICAgICAgICAgICAgdHJhbnNmb3JtOiBza2V3KDEwZGVnKTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgfQogICAgICAgICZfZGVjb3J7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKTsKICAgICAgICAgICAgd2lkdGg6IDFweDsKICAgICAgICAgICAgaGVpZ2h0OiAxLjVyZW07CiAgICAgICAgICAgIG1hcmdpbjogMCAuNXJlbTsKICAgICAgICB9CiAgICAgICAgaW1newogICAgICAgICAgICBtYXJnaW46IDAgLjJyZW07CiAgICAgICAgICAgIAogICAgICAgIH0KICAgICAgICAmOmhvdmVyewogICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDEuMDIpIHNrZXcoLTEwZGVnKTsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIC41cmVtICM0QjhBOUU7CiAgICAgICAgfSAgICAgCiAgICB9CiAgICBjYW52YXN7CiAgICAgICAgbWFyZ2luLWxlZnQ6IC42cmVtOwogICAgfQp9Cg=="},{"version":3,"sources":["Game.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Game.vue","sourceRoot":"src/views/NewDonateShop/Roulette","sourcesContent":["<template>\r\n    <div class=\"newdshop-roull-game\" ref=\"drparent\">\r\n        <div class=\"newdshop-roull-game_subtitle\">{{loc('newdshop:roul:game:sub')}}</div>\r\n        <div class=\"newdshop-roull-game_title\">{{type.name}}</div>\r\n        <div class=\"newdshop-roull-game_top\"></div>\r\n        <div class=\"newdshop-roull-game_top\"><img src=\"/img/newDonateShop/roulette/marker.svg\" alt=\"marker\"></div>\r\n        <canvas :width=\"width\" :height=\"height\" ref=\"drcanvas\"/>\r\n        <div class=\"newdshop-roull-game_bottom\"><img src=\"/img/newDonateShop/roulette/marker.svg\" alt=\"marker\"></div>\r\n        <div class=\"newdshop-roull-game-button\" @click=\"start\">\r\n            <div class=\"newdshop-roull-game-button_container\" v-if=\"this.isRun\">\r\n                <div>{{loc('newdshop:roul:game:btn:stop')}}</div>\r\n            </div>\r\n            <div class=\"newdshop-roull-game-button_container\" v-else>\r\n                <div>{{loc('newdshop:roul:game:btn:start')}}</div>\r\n                <div class=\"newdshop-roull-game-button_decor\"></div>\r\n                <img :src=\"currencyImg\" alt=\"coin\">\r\n                <div>{{type.price.toLocaleString()}}</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport {mapState, mapGetters, mapActions} from 'vuex'\r\nimport Slot from './Slot'\r\nimport {rouletteItemsById} from '../../../configs/newDonateShop'\r\n\r\nexport default {\r\n    props:{\r\n        type: Object\r\n    },\r\n    data() {\r\n        return {\r\n            width: 0,\r\n            height: 0,\r\n            canvas: null,\r\n            ctx: null,\r\n            countElements: 5,\r\n            speed: 0,\r\n            frameRate: 36,\r\n            maxSpeed: 150,\r\n            duration: 1500,\r\n            timeToStop: 0,\r\n            sizeItem: 0,\r\n            state:[],\r\n            itemList: [],\r\n            bgImg: null,\r\n            lastFrame: 0,\r\n            headResult: null,\r\n            winResult: null,\r\n            cancel: false,\r\n            antiFlood: 0,\r\n            stopFrom: 0,\r\n            sound: true,\r\n            winBuilded: false,\r\n            floodProtection: 0\r\n        }\r\n    },\r\n    computed:{\r\n        ...mapState('newDonateShop/roulette', ['isRun', 'isStop', 'isWin', 'result']),\r\n        ...mapState('newDonateShop', ['coins', 'gender']),\r\n        ...mapState('hud', ['money']),\r\n        ...mapGetters('localization', ['loc']),\r\n        currencyImg(){\r\n            return this.type.forCoins ? '/img/newDonateShop/header_coin.png' : '/img/newDonateShop/header_money.svg'\r\n        }\r\n    },\r\n    methods: {\r\n        ...mapActions('newDonateShop/roulette', ['requestStart','requestStop', 'requestFastStop', 'requestWin']),\r\n        start(){\r\n            //if(this.floodProtection > Date.now()) return;\r\n            if(this.isRun){\r\n                if(this.result !== -1 && !this.winBuilded){\r\n                    this.speed = 0;\r\n                    this.state = [];\r\n                    this.timeToStop = Date.now();\r\n                    this.builWinCombination(this.result);\r\n                    this.requestFastStop(this.type.forCoins);\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if(this.type.forCoins && this.coins < this.type.price){\r\n                    window.setData('notifyList/notify', {type: 1, position:2, message: 'dshop:item:buy:wrong:coins', time: 3000});\r\n                    return;\r\n                }\r\n                if(!this.type.forCoins && this.money < this.type.price){\r\n                    window.setData('notifyList/notify', {type: 1, position:2, message: 'dshop:item:buy:wrong:money', time: 3000});\r\n                    return;\r\n                }\r\n                //this.floodProtection = Date.now() + 500;\r\n                this.winBuilded = false;\r\n                this.requestStart(this.type.id);\r\n                this.timeToStop = Date.now() + this.duration;               \r\n            }              \r\n        },\r\n        addRandomElement(){\r\n            const last = this.state[this.state.length - 1];\r\n            let currentOffset = last ? (last.posX + last.size) : 0;\r\n            \r\n            const item = this.itemList[Math.floor(Math.random()*this.itemList.length)];\r\n            const slot = new Slot(this.ctx, item, this.height, this.bgImg, currentOffset);\r\n            this.state.push(slot);\r\n            return slot;\r\n        },\r\n        addWinElement(id){\r\n            const last = this.state[this.state.length - 1];\r\n            let currentOffset = last ? (last.posX + last.size) : 0;\r\n            const item = this.itemList.find(i=>i.id == id);\r\n            const slot = new Slot(this.ctx, item, this.height, this.bgImg, currentOffset);\r\n            this.state.push(slot);\r\n            return slot;\r\n        },\r\n        removeElement(){\r\n            this.state.shift();\r\n            //this.$store.commit(\"sounds/play\", { name: `tick`, volume: 0.03 })\r\n        },\r\n        initGame(){\r\n            this.state = [];\r\n            for (let index = 0; index < this.countElements + 2; index++) {\r\n                this.addRandomElement();                \r\n            }\r\n            requestAnimationFrame(this.updateState, this.canvas);\r\n            document.addEventListener(\"keyup\", this.keyHandler)\r\n        },\r\n        updateState(){\r\n            if(this.cancel) return;\r\n            if(this.lastFrame < Date.now() ){\r\n                if(this.isRun){\r\n                    this.lastFrame = Date.now() + this.frameRate;\r\n\r\n                    if(this.timeToStop < Date.now())\r\n                        this.requestStop();\r\n\r\n                    if(this.isStop)\r\n                        this.handleStop();\r\n                    else\r\n                        this.handleLoop();                    \r\n                }\r\n                this.drawFrame();\r\n            }\r\n            requestAnimationFrame(this.updateState, this.canvas);\r\n        },\r\n        handleLoop(){\r\n            if(!this) return\r\n            if(this.maxSpeed > this.speed)\r\n                this.speed += 5;\r\n\r\n            if(this.state[0].canDelete()){\r\n                this.removeElement();\r\n                this.addRandomElement();\r\n            }\r\n\r\n            this.state.forEach(item => {\r\n                item.moveX(this.speed);\r\n            });\r\n        },\r\n        handleStop(){\r\n            if(this.speed > this.maxSpeed * .2){\r\n                if(this.state[0].canDelete()){\r\n                    this.removeElement();\r\n                    this.addRandomElement();\r\n                }\r\n\r\n                this.state.forEach(item => {\r\n                    item.moveX(this.speed);\r\n                });\r\n                this.speed -= 1;\r\n            }else{                \r\n                if(!this.winBuilded){                   \r\n                    this.builWinCombination(this.result);\r\n                    this.stopFrom = this.headResult.posX;\r\n                }\r\n                const kof = Math.abs(this.headResult.posX / this.stopFrom);                \r\n                this.speed = Math.max(Math.floor(this.maxSpeed * kof * .2), 5);    \r\n                if(this.headResult.posX < 1) {\r\n                    const fix = this.headResult.posX;\r\n                    this.state.forEach(item => {\r\n                        item.fixPos(fix);\r\n                    });\r\n                    this.speed = 0;\r\n                    this.requestWin(this.type.forCoins);\r\n                }else{\r\n                    this.state.forEach(item => {\r\n                        item.moveX(this.speed);\r\n                    });\r\n                }\r\n                if(this.state[0].canDelete()){\r\n                    this.removeElement();\r\n                }\r\n            }\r\n        },\r\n        builWinCombination(val){\r\n            this.winBuilded = true;\r\n            for (let index = 0; index < this.countElements; index++) {\r\n                if(index == 0){\r\n                    this.headResult = this.addRandomElement();                  \r\n                }else if(index == 2){\r\n                    this.winResult = this.addWinElement(val);\r\n                }else\r\n                    this.addRandomElement();                            \r\n            }\r\n        },\r\n        drawFrame(){\r\n            this.ctx.globalCompositeOperation =\"normal\";\r\n            this.ctx.clearRect(0,0, this.width, this.height);\r\n            this.state.forEach(item => {\r\n                item.draw();\r\n            });\r\n            \r\n            if(this.isWin && this.winResult)\r\n                this.winResult.drawEffect();\r\n\r\n            let gradient = this.ctx.createLinearGradient(0,0, this.width, this.height);\r\n            gradient.addColorStop(0, 'rgba(0,0,0,0)');\r\n            gradient.addColorStop(.05, 'rgba(0,0,0,.1)');\r\n            gradient.addColorStop(.2, 'rgba(0,0,0,1)');\r\n            gradient.addColorStop(.8, 'rgba(0,0,0,1)');\r\n            gradient.addColorStop(.95, 'rgba(0,0,0,.1)');\r\n            gradient.addColorStop(1, 'rgba(0,0,0,0)');\r\n            this.ctx.fillStyle = gradient;\r\n            this.ctx.globalCompositeOperation =\"destination-in\";\r\n            this.ctx.beginPath();\r\n            this.ctx.fillRect(0,0,this.width, this.height);\r\n        },\r\n        initImages(){\r\n            this.bgImg = new Image(this.height, this.height);\r\n            this.bgImg.src = \"/img/newDonateShop/roulette/itemBg.png\";\r\n            this.itemList.forEach(item => {\r\n                item.img = new Image(this.height, this.height);\r\n                item.img.src = `/img/newDonateShop/items/${item.image}.png`;\r\n            });\r\n        },\r\n        keyHandler(e){\r\n            if(e.keyCode === 13){\r\n                this.start();\r\n            }\r\n        }\r\n    },\r\n    mounted(){\r\n        this.itemList = [];\r\n        this.$store.commit('newDonateShop/roulette/reset');\r\n        const parrent = this.$refs[\"drparent\"];\r\n        this.width = parrent.offsetWidth;\r\n        this.height = parrent.offsetWidth / this.countElements;\r\n        this.itemList = rouletteItemsById(this.type.id, this.gender);\r\n        this.initImages();\r\n        this.canvas = this.$refs[\"drcanvas\"];\r\n        this.ctx = this.canvas.getContext(\"2d\");\r\n        this.frameRate = Math.floor(1000/this.frameRate);\r\n        setTimeout(this.initGame, 500);\r\n    },\r\n    beforeDestroy(){\r\n        document.removeEventListener(\"keyup\", this.keyHandler);\r\n        this.cancel = true;\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n    .newdshop-roull-game{\r\n        width: 80rem;\r\n        align-self: flex-start;\r\n        margin-top: 1.5rem;\r\n        &_subtitle{\r\n            margin-top: 3rem;\r\n            font-size: .8rem;\r\n            color: rgba(#fff, .5);\r\n            text-align: center;\r\n        }\r\n        &_title{\r\n            font-size: 3.5rem;\r\n            font-weight: 700;\r\n            letter-spacing: .07rem;\r\n            text-align: center;\r\n            margin-bottom: 4rem;\r\n            text-shadow: 0 0 .8rem rgba(#fff, .7);\r\n        }\r\n        &_top{\r\n            text-align: center;\r\n        }\r\n        &_bottom{\r\n            text-align: center;\r\n            transform: rotate(180deg);\r\n        }\r\n        &-button{\r\n            background-color: #4B8A9E;\r\n            width: 10.7rem;\r\n            margin: 3rem auto;\r\n            border-radius: .2rem;\r\n            transform: skew(-10deg);\r\n            &_container{\r\n                height: 3rem;\r\n                width: 10.7rem;\r\n                transform: skew(10deg);\r\n                display: flex;\r\n                justify-content: center;\r\n                align-items: center;\r\n            }\r\n            &_decor{\r\n                background-color: rgba(255, 255, 255, 0.2);\r\n                width: 1px;\r\n                height: 1.5rem;\r\n                margin: 0 .5rem;\r\n            }\r\n            img{\r\n                margin: 0 .2rem;\r\n                \r\n            }\r\n            &:hover{\r\n                transform: scale(1.02) skew(-10deg);\r\n                box-shadow: 0 0 .5rem #4B8A9E;\r\n            }     \r\n        }\r\n        canvas{\r\n            margin-left: .6rem;\r\n        }\r\n    }\r\n</style>"]}]}