{"remainingRequest":"D:\\downloads\\UNIQ\\Gui\\node_modules\\thread-loader\\dist\\cjs.js!D:\\downloads\\UNIQ\\Gui\\node_modules\\babel-loader\\lib\\index.js!D:\\downloads\\UNIQ\\Gui\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\downloads\\UNIQ\\Gui\\src\\store\\smartphone\\modules\\message-page.js","dependencies":[{"path":"D:\\downloads\\UNIQ\\Gui\\src\\store\\smartphone\\modules\\message-page.js","mtime":1629112495829},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1685190017390},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1685190017367},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\babel-loader\\lib\\index.js","mtime":1685190019507},{"path":"D:\\downloads\\UNIQ\\Gui\\node_modules\\eslint-loader\\index.js","mtime":1685190018634}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQtaW5kZXgiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkQ6L2Rvd25sb2Fkcy9VTklRL0d1aS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZXNwYWNlZDogdHJ1ZSwKICBzdGF0ZTogewogICAgbWVzc2VuZ2VyRGF0YTogewogICAgICBDdXJyZW50QWNjb3VudDogewogICAgICAgIElkOiAtMSwKICAgICAgICBVc2VybmFtZTogJ21pbHQnLAogICAgICAgIERpc3BsYXllZE5hbWU6ICdtYXR2ZXknLAogICAgICAgIElzTnVtYmVySGlkZWQ6IGZhbHNlCiAgICAgIH0sCiAgICAgIFNlYXJjaFN1YnNjcmliZXJzOiBbLy8geyBJZDogMCwgRGlzcGxheWVkTmFtZTogJ0dheSBNYW4nLCBMYXN0VmlzaXRUaW1lOiAyMDMzMzEyMTIzMzIgfQogICAgICBdLAogICAgICBDaGF0czogWy8vIHsgSWQ6IDgsIE5hbWU6ICdGaXJzdCBjaGF0OCcsIElzT25saW5lOiB0cnVlLCBUeXBlOiAwLCBOb25SZWFkTWVzc2FnZXNDb3VudDogMCwKICAgICAgICAvLyBMYXN0TWVzc2FnZTogeyBJZDogMCwgQ2hhdElkOiAwLCBUZXh0OiAnSGkhIFdobyBhcmUgeW91PycsIFR5cGU6IDAsCiAgICAgICAgLy8gVGltZTogMTYwMzAwNTEzMjAwMCwgSXNSZWFkOiBmYWxzZSwgQWRtaW5zOiBbCiAgICAgICAgLy8gICAgeyBEaXNwbGF5ZWROYW1lOiAnR29uZG9uJywgSWQ6IDIsIEFkbWluTHZsOiAyLCBQZXJtaXNzaW9uOiBbMCwgMiwgMywgNF0gfSAKICAgICAgICAvLyBdIH0gfSwKICAgICAgXSwKICAgICAgQ29udGFjdHM6IFsvLyB7IElkOiAxMiwgTmFtZTogJ+GDoeGDkOGDnOGDouGDlOGDpeGDnOGDmOGDmeGDneGDoeGDmCcsIE51bWJlcjogODgwMDU1NDM1MzUsIFRpbWU6IDExMzA0NDMyMDAwMDAsIElzT25saW5lOiB0cnVlIH0sCiAgICAgIF0sCiAgICAgIF9jYWNoZWRBY2NvdW50czogWy8vIHsgSWQ6IDAsIERpc3BsYXllZE5hbWU6ICfRhNCw0LrQsdC+0LknIH0KICAgICAgXSwKICAgICAgX2NhY2hlZE1lc3NhZ2VzOiBbXSwKICAgICAgQ3VycmVudENoYXQ6IHsKICAgICAgICBJZDogMCwKICAgICAgICBOYW1lOiAnU0pTSkZLV1BDT0VKViBTSkVLUklGSkFORExXUicsCiAgICAgICAgSXNPbmxpbmU6IG51bGwsCiAgICAgICAgVHlwZTogMCwKICAgICAgICBJY29uQ29sb3JzOiAnbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjNDNFOTdCIDAlLCAjMzhGOUQ3IDEwMCUpJywKICAgICAgICBTdWJzY3JpYmVyc0NvdW50OiAxMjMsCiAgICAgICAgSXRlbXM6IFsvLyB7IElkOiAwLCBDaGF0SWQ6IDAsIFNlbmRlcklkOiAwLCBUZXh0OiAnSGkhIFdobyBhcmUgeW91PyDwn5iD8J+YgScsIEF0dGFjaG1lbnQ6IG51bGwgLCBUaW1lOiAxNjAzMjAyODk4NDgyLCBJc1JlYWQ6IHRydWUgfSwKICAgICAgICAgIC8vIHsgSWQ6IDEsIENoYXRJZDogMCwgU2VuZGVySWQ6IDEsIFRleHQ6ICdJdGBzIG1lLCBuaWdnYSwgYXlvJywgQXR0YWNobWVudDogeyBJZDogMSwgVHlwZTogMiwgVXJsOiAnaHR0cHM6Ly9jNC53YWxscGFwZXJmbGFyZS5jb20vd2FsbHBhcGVyLzUwMC80NDIvMzU0L291dHJ1bi12YXBvcndhdmUtaGQtd2FsbHBhcGVyLXByZXZpZXcuanBnJyB9LCBUaW1lOiAxNjAzMjAyODk4NDg3LCBJc1JlYWQ6IHRydWUgfSwKICAgICAgICAgIC8vIHsgSWQ6IDAsIENoYXRJZDogMCwgU2VuZGVySWQ6IDEsIFRleHQ6ICcnLCBBdHRhY2htZW50OiB7IElkOiAxLCBUeXBlOiAwLCBHZW9NYXJrOiB7IFg6IDEwMCwgWTogMTAwLCBaOiAxMDB9IH0gLCBUaW1lOiAxNjAzMjAyODk4NDgyLCBJc1JlYWQ6IHRydWUgfSwKICAgICAgICAgIC8vIHsgSWQ6IDAsIENoYXRJZDogMCwgU2VuZGVySWQ6IDAsIFRleHQ6ICcnLCBBdHRhY2htZW50OiB7IElkOiAxLCBUeXBlOiAwLCBHZW9NYXJrOiB7IFg6IDEwMCwgWTogMTAwLCBaOiAxMDB9IH0gLCBUaW1lOiAxNjAzMjAyODk4NDgyLCBJc1JlYWQ6IHRydWUgfSwKICAgICAgICAgIC8vIHsgSWQ6IDEsIENoYXRJZDogMCwgU2VuZGVySWQ6IDAsIFRleHQ6ICcnLCBBdHRhY2htZW50OiB7IElkOiAxLCBUeXBlOiAyLCBVcmw6ICdodHRwczovL2M0LndhbGxwYXBlcmZsYXJlLmNvbS93YWxscGFwZXIvNTAwLzQ0Mi8zNTQvb3V0cnVuLXZhcG9yd2F2ZS1oZC13YWxscGFwZXItcHJldmlldy5qcGcnIH0sIFRpbWU6IDE2MDMyMDI4OTg0ODcsIElzUmVhZDogdHJ1ZSB9LAogICAgICAgICAgLy8geyBJZDogMSwgQ2hhdElkOiAwLCBTZW5kZXJJZDogMSwgVGV4dDogJycsIEF0dGFjaG1lbnQ6IHsgSWQ6IDEsIFR5cGU6IDIsIFVybDogJ2h0dHBzOi8vYzQud2FsbHBhcGVyZmxhcmUuY29tL3dhbGxwYXBlci81MDAvNDQyLzM1NC9vdXRydW4tdmFwb3J3YXZlLWhkLXdhbGxwYXBlci1wcmV2aWV3LmpwZycgfSwgVGltZTogMTYwMzIwMjg5ODQ4NywgSXNSZWFkOiB0cnVlIH0sCiAgICAgICAgICAvLyB7IElkOiAyLCBDaGF0SWQ6IDAsIFNlbmRlcklkOiAyLCBUZXh0OiAnTW1tLCBvay5NbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBvaycsIFRpbWU6IDE2MDMzMDg4OTg0ODcsIElzUmVhZDogZmFsc2UgfSwKICAgICAgICAgIC8vIHsgSWQ6IDIsIENoYXRJZDogMCwgU2VuZGVySWQ6IDIsIFRleHQ6ICdNbW0sIG9rLk1tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rJywgVGltZTogMTYwMzMwODg5ODQ4NywgSXNSZWFkOiBmYWxzZSB9LAogICAgICAgICAgLy8geyBJZDogMiwgQ2hhdElkOiAwLCBTZW5kZXJJZDogMiwgVGV4dDogJ01tbSwgb2suTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2snLCBUaW1lOiAxNjAzMzA4ODk4NDg3LCBJc1JlYWQ6IGZhbHNlIH0sCiAgICAgICAgICAvLyB7IElkOiAyLCBDaGF0SWQ6IDAsIFNlbmRlcklkOiAyLCBUZXh0OiAnTW1tLCBvay5NbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBvaycsIFRpbWU6IDE2MDMzMDg4OTg0ODcsIElzUmVhZDogZmFsc2UgfSwKICAgICAgICAgIC8vIHsgSWQ6IDIsIENoYXRJZDogMCwgU2VuZGVySWQ6IDIsIFRleHQ6ICdNbW0sIG9rLk1tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rTW1tLCBva01tbSwgb2tNbW0sIG9rJywgVGltZTogMTYwMzMwODg5ODQ4NywgSXNSZWFkOiBmYWxzZSB9LAogICAgICAgIF0sCiAgICAgICAgSXNMb2FkaW5nOiBmYWxzZQogICAgICB9LAogICAgICBDYW5hbFByb2ZpbGU6IHsKICAgICAgICBOYW1lOiAn0KHQsNC80YvQuSDQtNC70LjQvdC90YvQuSDQvdC40Log0LIg0LjQs9GA0LUnLAogICAgICAgIElzT25saW5lOiB0cnVlLAogICAgICAgIEFkbWluTHZsOiAyLAogICAgICAgIEFiaWxpdGllczogewogICAgICAgICAgY2hhbmdlUHJvZmlsZTogdHJ1ZSwKICAgICAgICAgIGNyZWF0ZVBvc3RzOiBmYWxzZSwKICAgICAgICAgIGRlbGV0ZVBvc3RzOiBmYWxzZSwKICAgICAgICAgIGFwcG9pbnRtZW50QWRtaW5zOiBmYWxzZQogICAgICAgIH0KICAgICAgfSwKICAgICAgdmlld2VkUHJvZmlsZTogewogICAgICAgIElkOiAxLAogICAgICAgIFVzZXJuYW1lOiAndXNlcm5hbWUnLAogICAgICAgIERpc3BsYXllZE5hbWU6ICfQodCw0LzRi9C5INC00LvQuNC90L3Ri9C5INC90LjQuiDQsiDQuNCz0YDQtScsCiAgICAgICAgTnVtYmVyOiA5MzkzOTQsCiAgICAgICAgSXNOdW1iZXJIaWRlZDogZmFsc2UsCiAgICAgICAgSXNNdXRlZDogZmFsc2UsCiAgICAgICAgSXNCbG9ja2VkOiBmYWxzZSwKICAgICAgICBMYXN0VmlzaXRUaW1lOiAxNjAzOTU5MDcxMDAwLAogICAgICAgIElzT25saW5lOiBmYWxzZSwKICAgICAgICBJc0luQ29udGFjdHM6IGZhbHNlLAogICAgICAgIGlzTG9hZGluZzogZmFsc2UKICAgICAgfQogICAgfQogIH0sCiAgbXV0YXRpb25zOiB7CiAgICBzZXRNZXNzZW5nZXJDYW5hbFByb2ZpbGVBYmlsaXR5OiBmdW5jdGlvbiBzZXRNZXNzZW5nZXJDYW5hbFByb2ZpbGVBYmlsaXR5KHN0YXRlLCBfcmVmKSB7CiAgICAgIHZhciBrZXkgPSBfcmVmLmtleSwKICAgICAgICAgIHZhbHVlID0gX3JlZi52YWx1ZTsKICAgICAgdmFyIGN1cnJlbnRDaGF0ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdDsKICAgICAgdmFyIGNoYXQgPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNoYXRzLmZpbmQoZnVuY3Rpb24gKGMpIHsKICAgICAgICByZXR1cm4gYy5JZCA9PT0gY3VycmVudENoYXQuSWQ7CiAgICAgIH0pOwogICAgICB2YXIgYWRtaW4gPSBjaGF0LkFkbWlucy5maW5kKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEuSWQgPT09IHN0YXRlLm1lc3NlbmdlckRhdGEuQ2FuYWxQcm9maWxlLklkOwogICAgICB9KTsKCiAgICAgIGlmIChhZG1pbikgewogICAgICAgIGlmICh2YWx1ZSkgYWRtaW4uUGVybWlzc2lvbnMucHVzaChrZXkpO2Vsc2UgewogICAgICAgICAgdmFyIGlkeCA9IGFkbWluLlBlcm1pc3Npb25zLmluZGV4T2Yoa2V5KTsKICAgICAgICAgIGlmIChpZHgpIGFkbWluLlBlcm1pc3Npb25zLnNwbGljZShpZHgsIDEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY3VycmVudENoYXQuQWRtaW5zID0gY2hhdC5BZG1pbnM7CiAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ2FuYWxQcm9maWxlLlBlcm1pc3Npb25zID0gYWRtaW4uUGVybWlzc2lvbnM7CiAgICAgIHdpbmRvdy5tcC50cmlnZ2VyU2VydmVyKCdwaG9uZTo6bXNnOjptYW5hZ2U6OnNldEFjY291bnRQZXJtaXNzaW9uJywgY2hhdC5JZCwgYWRtaW4uSWQsIGtleSwgdmFsdWUpOwogICAgfSwKICAgIHNldE1lc3NlbmdlckN1cnJlbnRDaGF0SWNvbkNvbG9yczogZnVuY3Rpb24gc2V0TWVzc2VuZ2VyQ3VycmVudENoYXRJY29uQ29sb3JzKHN0YXRlLCB2YWx1ZSkgewogICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0Lkljb25Db2xvcnMgPSB2YWx1ZTsKICAgIH0sCiAgICBtc2dfc2V0QWNjb3VudFNldHRpbmdzOiBmdW5jdGlvbiBtc2dfc2V0QWNjb3VudFNldHRpbmdzKHN0YXRlLCBhY2NvdW50U2V0dGluZ3MpIHsKICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50QWNjb3VudCA9IGFjY291bnRTZXR0aW5nczsKICAgIH0sCiAgICAvLyNyZWdpb24gTXNnIENvbnRhY3RzCiAgICBtc2dfc2V0U3Vic2NyaWJlcnNGb3JTZWFyY2g6IGZ1bmN0aW9uIG1zZ19zZXRTdWJzY3JpYmVyc0ZvclNlYXJjaChzdGF0ZSwgc3Vic2NyaWJlcnMpIHsKICAgICAgc3Vic2NyaWJlcnMuZm9yRWFjaChmdW5jdGlvbiAoc3Vic2NyaWJlcikgewogICAgICAgIGlmIChzdWJzY3JpYmVyLkxhc3RWaXNpdFRpbWUpIHN1YnNjcmliZXJzLkxhc3RWaXNpdFRpbWUgKj0gMTAwMDsKICAgICAgfSk7CiAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuU2VhcmNoU3Vic2NyaWJlcnMgPSBzdWJzY3JpYmVyczsKICAgIH0sCiAgICBtc2dfbG9hZENvbnRhY3RzOiBmdW5jdGlvbiBtc2dfbG9hZENvbnRhY3RzKHN0YXRlLCBjb250YWN0cykgewogICAgICBjb250YWN0cy5mb3JFYWNoKGZ1bmN0aW9uIChjb250YWN0KSB7CiAgICAgICAgaWYgKGNvbnRhY3QuVGltZSkgY29udGFjdC5UaW1lICo9IDEwMDA7CiAgICAgICAgdmFyIG9sZENvbnRhY3RJbmRleCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ29udGFjdHMuZmluZEluZGV4KGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICByZXR1cm4gYy5JZCA9PT0gY29udGFjdC5JZDsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKG9sZENvbnRhY3RJbmRleCA9PT0gLTEpIHsKICAgICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ29udGFjdHMucHVzaChjb250YWN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5Db250YWN0c1tvbGRDb250YWN0SW5kZXhdID0gY29udGFjdDsKICAgICAgICB9CgogICAgICAgIHZhciBwcml2YXRlQ2hhdCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMuZmluZChmdW5jdGlvbiAoYykgewogICAgICAgICAgcmV0dXJuIGMuQWNjb3VudElkID09PSBjb250YWN0LkFjY291bnRJZDsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHByaXZhdGVDaGF0KSB7CiAgICAgICAgICBwcml2YXRlQ2hhdC5OYW1lID0gY29udGFjdC5OYW1lOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgbXNnX3JlbW92ZVN0b3JlQ29udGFjdDogZnVuY3Rpb24gbXNnX3JlbW92ZVN0b3JlQ29udGFjdChzdGF0ZSwgY29udGFjdElkKSB7CiAgICAgIHZhciBjb250YWN0SW5kZXggPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNvbnRhY3RzLmZpbmRJbmRleChmdW5jdGlvbiAoYykgewogICAgICAgIHJldHVybiBjLklkID09PSBjb250YWN0SWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKGNvbnRhY3RJbmRleCAhPT0gLTEpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNvbnRhY3RzLnNwbGljZShjb250YWN0SW5kZXgsIDEpOwogICAgICB9CiAgICB9LAogICAgbXNnX3NldENvbnRhY3RJc09ubGluZTogZnVuY3Rpb24gbXNnX3NldENvbnRhY3RJc09ubGluZShzdGF0ZSwgX3JlZjIpIHsKICAgICAgdmFyIGNvbnRhY3RJZCA9IF9yZWYyLmNvbnRhY3RJZCwKICAgICAgICAgIGlzT25saW5lID0gX3JlZjIuaXNPbmxpbmU7CiAgICAgIHZhciBjb250YWN0SW5kZXggPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNvbnRhY3RzLmZpbmRJbmRleChmdW5jdGlvbiAoYykgewogICAgICAgIHJldHVybiBjLklkID09PSBjb250YWN0SWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKGNvbnRhY3RJbmRleCAhPT0gLTEpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNvbnRhY3RzW2NvbnRhY3RJbmRleF0uSXNPbmxpbmUgPSBpc09ubGluZTsKICAgICAgfQogICAgfSwKICAgIC8vI2VuZHJlZ2lvbiBNc2cgQ29udGFjdHMKICAgIC8vI3JlZ2lvbiBNc2cgQ2hhdHMKICAgIG1zZ19sb2FkQ2hhdHM6IGZ1bmN0aW9uIG1zZ19sb2FkQ2hhdHMoc3RhdGUsIGNoYXRzKSB7CiAgICAgIGNoYXRzLmZvckVhY2goZnVuY3Rpb24gKGNoYXQpIHsKICAgICAgICB2YXIgX2NoYXQkTGFzdE1lc3NhZ2UkVGltLCBfY2hhdCRMYXN0TWVzc2FnZTsKCiAgICAgICAgdmFyIGNoYXRJbmRleCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMuZmluZEluZGV4KGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICByZXR1cm4gYy5JZCA9PT0gY2hhdC5JZDsKICAgICAgICB9KTsKICAgICAgICBjaGF0LkFjdGlvblRpbWUgPSAoX2NoYXQkTGFzdE1lc3NhZ2UkVGltID0gKF9jaGF0JExhc3RNZXNzYWdlID0gY2hhdC5MYXN0TWVzc2FnZSkgPT09IG51bGwgfHwgX2NoYXQkTGFzdE1lc3NhZ2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jaGF0JExhc3RNZXNzYWdlLlRpbWUpICE9PSBudWxsICYmIF9jaGF0JExhc3RNZXNzYWdlJFRpbSAhPT0gdm9pZCAwID8gX2NoYXQkTGFzdE1lc3NhZ2UkVGltIDogY2hhdC5DcmVhdGVkVGltZTsKICAgICAgICBjaGF0LkFjdGlvblRpbWUgKj0gMTAwMDsKCiAgICAgICAgaWYgKGNoYXRJbmRleCA9PT0gLTEpIHsKICAgICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMucHVzaChjaGF0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5zcGxpY2UoY2hhdEluZGV4LCAxKTsKICAgICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMucHVzaChjaGF0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIG1zZ19yZW1vdmVDaGF0OiBmdW5jdGlvbiBtc2dfcmVtb3ZlQ2hhdChzdGF0ZSwgY2hhdElkKSB7CiAgICAgIHZhciBjaGF0SWR4ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5maW5kSW5kZXgoZnVuY3Rpb24gKGMpIHsKICAgICAgICByZXR1cm4gYy5JZCA9PT0gY2hhdElkOwogICAgICB9KTsKCiAgICAgIGlmIChjaGF0SWR4ICE9PSAtMSkgewogICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMuc3BsaWNlKGNoYXRJZHgsIDEpOwogICAgICB9CiAgICB9LAogICAgbXNnX2NhY2hlTWVzc2FnZTogZnVuY3Rpb24gbXNnX2NhY2hlTWVzc2FnZShzdGF0ZSwgbWVzc2FnZSkgewogICAgICB2YXIgY2FjaGVkTWVzc2FnZUluZGV4ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5fY2FjaGVkTWVzc2FnZXMuZmluZEluZGV4KGZ1bmN0aW9uIChtKSB7CiAgICAgICAgcmV0dXJuIG0uSWQgPT09IG1lc3NhZ2UuSWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKGNhY2hlZE1lc3NhZ2VJbmRleCA9PT0gLTEpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLl9jYWNoZWRNZXNzYWdlcy5wdXNoKG1lc3NhZ2UpOwogICAgICB9IGVsc2UgewogICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuX2NhY2hlZE1lc3NhZ2VzW2NhY2hlZE1lc3NhZ2VJbmRleF0gPSBtZXNzYWdlOwogICAgICB9CiAgICB9LAogICAgbXNnX3VuY2FjaGVNZXNzYWdlOiBmdW5jdGlvbiBtc2dfdW5jYWNoZU1lc3NhZ2Uoc3RhdGUsIG1lc3NhZ2VJZCkgewogICAgICB2YXIgY2FjaGVkTWVzc2FnZUluZGV4ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5fY2FjaGVkTWVzc2FnZXMuZmluZEluZGV4KGZ1bmN0aW9uIChtKSB7CiAgICAgICAgcmV0dXJuIG0uSWQgPT09IG1lc3NhZ2VJZDsKICAgICAgfSk7CgogICAgICBpZiAoY2FjaGVkTWVzc2FnZUluZGV4ICE9PSAtMSkgewogICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuX2NhY2hlZE1lc3NhZ2VzLnNwbGljZShjYWNoZWRNZXNzYWdlSW5kZXgsIDEpOwogICAgICB9CiAgICB9LAogICAgbXNnX21hcmtDaGF0TWVzc2FnZXNBc1JlYWQ6IGZ1bmN0aW9uIG1zZ19tYXJrQ2hhdE1lc3NhZ2VzQXNSZWFkKHN0YXRlLCBjaGF0SWQpIHsKICAgICAgdmFyIGNoYXQgPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNoYXRzLmZpbmQoZnVuY3Rpb24gKGMpIHsKICAgICAgICByZXR1cm4gYy5JZCA9PT0gY2hhdElkOwogICAgICB9KTsKCiAgICAgIGlmIChjaGF0KSB7CiAgICAgICAgY2hhdC5Ob25SZWFkTWVzc2FnZXNDb3VudCA9IDA7CiAgICAgIH0KICAgIH0sCiAgICBtc2dfc2V0T3duTWVzc2FnZXNSZWFkSW5DaGF0OiBmdW5jdGlvbiBtc2dfc2V0T3duTWVzc2FnZXNSZWFkSW5DaGF0KHN0YXRlLCBjaGF0SWQpIHsKICAgICAgaWYgKHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSWQgPT09IGNoYXRJZCkgewogICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSXRlbXMuZm9yRWFjaChmdW5jdGlvbiAobSkgewogICAgICAgICAgaWYgKG0uU2VuZGVySWQgPT09IHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudEFjY291bnQuSWQpIHsKICAgICAgICAgICAgbS5Jc1JlYWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLl9jYWNoZWRNZXNzYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChtKSB7CiAgICAgICAgaWYgKG0uU2VuZGVySWQgPT09IHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudEFjY291bnQuSWQpIHsKICAgICAgICAgIG0uSXNSZWFkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIG1zZ19zZXRMYXN0TWVzc2FnZTogZnVuY3Rpb24gbXNnX3NldExhc3RNZXNzYWdlKHN0YXRlLCBtZXNzYWdlKSB7CiAgICAgIHZhciBjaGF0ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5maW5kKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgcmV0dXJuIGMuSWQgPT09IG1lc3NhZ2UuQ2hhdElkOwogICAgICB9KTsKCiAgICAgIGlmIChjaGF0KSB7CiAgICAgICAgY2hhdC5MYXN0TWVzc2FnZSA9IG1lc3NhZ2U7CiAgICAgICAgY2hhdC5BY3Rpb25UaW1lID0gbWVzc2FnZS5UaW1lOwogICAgICB9CiAgICB9LAogICAgbXNnX3NldEN1cnJlbnRDaGF0SXNMb2FkaW5nOiBmdW5jdGlvbiBtc2dfc2V0Q3VycmVudENoYXRJc0xvYWRpbmcoc3RhdGUsIHRvZ2dsZSkgewogICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklzTG9hZGluZyA9IHRvZ2dsZTsKICAgIH0sCiAgICBtc2dfc2V0Q3VycmVudENoYXRNZXNzYWdlczogZnVuY3Rpb24gbXNnX3NldEN1cnJlbnRDaGF0TWVzc2FnZXMoc3RhdGUsIG1lc3NhZ2VzKSB7CiAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSXRlbXMgPSBtZXNzYWdlczsKICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5Jc0xvYWRpbmcgPSBmYWxzZTsKICAgIH0sCiAgICBtc2dfc2V0Q3VycmVudENoYXQ6IGZ1bmN0aW9uIG1zZ19zZXRDdXJyZW50Q2hhdChzdGF0ZSwgX3JlZjMpIHsKICAgICAgdmFyIElkID0gX3JlZjMuSWQsCiAgICAgICAgICBOYW1lID0gX3JlZjMuTmFtZSwKICAgICAgICAgIElzT25saW5lID0gX3JlZjMuSXNPbmxpbmUsCiAgICAgICAgICBUeXBlID0gX3JlZjMuVHlwZSwKICAgICAgICAgIFN1YnNjcmliZXJzQ291bnQgPSBfcmVmMy5TdWJzY3JpYmVyc0NvdW50LAogICAgICAgICAgQWNjb3VudElkID0gX3JlZjMuQWNjb3VudElkLAogICAgICAgICAgSWNvbkNvbG9ycyA9IF9yZWYzLkljb25Db2xvcnMsCiAgICAgICAgICBQZXJtaXNzaW9ucyA9IF9yZWYzLlBlcm1pc3Npb25zLAogICAgICAgICAgRGVzY3JpcHRpb24gPSBfcmVmMy5EZXNjcmlwdGlvbiwKICAgICAgICAgIEFkbWluTHZsID0gX3JlZjMuQWRtaW5MdmwsCiAgICAgICAgICBJbnZpdGVDb2RlID0gX3JlZjMuSW52aXRlQ29kZSwKICAgICAgICAgIEFkbWlucyA9IF9yZWYzLkFkbWlucywKICAgICAgICAgIEJsb2NrSXRlbXMgPSBfcmVmMy5CbG9ja0l0ZW1zOwogICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0ID0gewogICAgICAgIElkOiBJZCwKICAgICAgICBOYW1lOiBOYW1lLAogICAgICAgIElzT25saW5lOiBJc09ubGluZSwKICAgICAgICBUeXBlOiBUeXBlLAogICAgICAgIEFkbWluTHZsOiBBZG1pbkx2bCwKICAgICAgICBEZXNjcmlwdGlvbjogRGVzY3JpcHRpb24sCiAgICAgICAgU3Vic2NyaWJlcnNDb3VudDogU3Vic2NyaWJlcnNDb3VudCwKICAgICAgICBJbnZpdGVDb2RlOiBJbnZpdGVDb2RlLAogICAgICAgIEFkbWluczogQWRtaW5zLAogICAgICAgIEJsb2NrSXRlbXM6IEJsb2NrSXRlbXMKICAgICAgfTsgLy8gQ2hhbm5lbCBhbmQgZ3JvdXAgY2hhdHMgZmllbGRzCgogICAgICBpZiAoUGVybWlzc2lvbnMpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LkNhbkNoYW5naW5nR3JvdXBQcm9maWxlID0gUGVybWlzc2lvbnMuaW5jbHVkZXMoMSk7CiAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5DYW5EZWxldGluZ01lc3NhZ2VzID0gUGVybWlzc2lvbnMuaW5jbHVkZXMoMik7CiAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5DYW5CbG9ja2luZ0FjY291bnRzID0gUGVybWlzc2lvbnMuaW5jbHVkZXMoMyk7CiAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5DYW5QdXJwb3NpbmdBZG1pbnMgPSBQZXJtaXNzaW9ucy5pbmNsdWRlcyg0KTsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LkNhbkNyZWF0aW5nUG9zdHMgPSBQZXJtaXNzaW9ucy5pbmNsdWRlcyg1KTsKICAgICAgfQoKICAgICAgaWYgKEljb25Db2xvcnMpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0Lkljb25Db2xvcnMgPSBJY29uQ29sb3JzOwogICAgICB9IC8vIFByaXZhdGUgY2hhdHMgZmllbGQKCgogICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LkFjY291bnRJZCA9IEFjY291bnRJZDsKICAgIH0sCiAgICBtc2dfbG9hZEFjY291bnRzOiBmdW5jdGlvbiBtc2dfbG9hZEFjY291bnRzKHN0YXRlLCBhY2NvdW50cykgewogICAgICBhY2NvdW50cy5mb3JFYWNoKGZ1bmN0aW9uIChhY2NvdW50KSB7CiAgICAgICAgdmFyIGNvbnRhY3QgPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNvbnRhY3RzLmZpbmQoZnVuY3Rpb24gKGMpIHsKICAgICAgICAgIHJldHVybiBjLkFjY291bnRJZCA9PT0gYWNjb3VudC5JZDsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGNvbnRhY3QpIHsKICAgICAgICAgIGFjY291bnQuRGlzcGxheWVkTmFtZSA9IGNvbnRhY3QuTmFtZTsKICAgICAgICB9CgogICAgICAgIHZhciBhY2NvdW50SW5kZXggPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLl9jYWNoZWRBY2NvdW50cy5maW5kSW5kZXgoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLklkID09IGFjY291bnQuSWQ7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChhY2NvdW50SW5kZXggPT09IC0xKSB7CiAgICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLl9jYWNoZWRBY2NvdW50cy5wdXNoKGFjY291bnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLl9jYWNoZWRBY2NvdW50c1thY2NvdW50SW5kZXhdID0gYWNjb3VudDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIG1zZ19zZXRDaGF0TXV0ZWQ6IGZ1bmN0aW9uIG1zZ19zZXRDaGF0TXV0ZWQoc3RhdGUsIF9yZWY0KSB7CiAgICAgIHZhciBDaGF0SWQgPSBfcmVmNC5DaGF0SWQsCiAgICAgICAgICBJc011dGVkID0gX3JlZjQuSXNNdXRlZDsKCiAgICAgIGlmIChzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklkID09PSBDaGF0SWQpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklzTXV0ZWQgPSBJc011dGVkOwogICAgICB9CgogICAgICB2YXIgY2hhdCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMuZmluZChmdW5jdGlvbiAoYykgewogICAgICAgIHJldHVybiBjLklkID09PSBDaGF0SWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKGNoYXQpIHsKICAgICAgICBjaGF0LklzTXV0ZWQgPSBJc011dGVkOwogICAgICB9CiAgICB9LAogICAgbXNnX3JlbmFtZUNoYXQ6IGZ1bmN0aW9uIG1zZ19yZW5hbWVDaGF0KHN0YXRlLCBfcmVmNSkgewogICAgICB2YXIgQ2hhdElkID0gX3JlZjUuQ2hhdElkLAogICAgICAgICAgTmFtZSA9IF9yZWY1Lk5hbWU7CiAgICAgIHZhciBjaGF0ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5maW5kKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgcmV0dXJuIGMuSWQgPT09IENoYXRJZDsKICAgICAgfSk7CgogICAgICBpZiAoY2hhdCkgewogICAgICAgIGNoYXQuTmFtZSA9IE5hbWU7CiAgICAgIH0KCiAgICAgIGlmIChzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklkID09PSBDaGF0SWQpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0Lk5hbWUgPSBOYW1lOwogICAgICB9CiAgICB9LAogICAgbXNnX2luY3JlYXNlU3Vic2NyaWJlcnNDb3VudDogZnVuY3Rpb24gbXNnX2luY3JlYXNlU3Vic2NyaWJlcnNDb3VudChzdGF0ZSwgY2hhdElkKSB7CiAgICAgIGlmIChzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklkID09PSBjaGF0SWQpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LlN1YnNjcmliZXJzQ291bnQrKzsKICAgICAgfQoKICAgICAgdmFyIGNoYXQgPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNoYXRzLmZpbmQoZnVuY3Rpb24gKGMpIHsKICAgICAgICByZXR1cm4gYy5JZCA9PT0gY2hhdElkOwogICAgICB9KTsKCiAgICAgIGlmIChjaGF0KSB7CiAgICAgICAgaWYgKCFjaGF0LlN1YnNjcmliZXJzQ291bnQpIHsKICAgICAgICAgIGNoYXQuU3Vic2NyaWJlcnNDb3VudCA9IDA7CiAgICAgICAgfQoKICAgICAgICBjaGF0LlN1YnNjcmliZXJzQ291bnQrKzsKICAgICAgfQogICAgfSwKICAgIG1zZ19kZWNyZWFzZVN1YnNjcmliZXJzQ291bnQ6IGZ1bmN0aW9uIG1zZ19kZWNyZWFzZVN1YnNjcmliZXJzQ291bnQoc3RhdGUsIGNoYXRJZCkgewogICAgICBpZiAoc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5JZCA9PT0gY2hhdElkKSB7CiAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5TdWJzY3JpYmVyc0NvdW50LS07CiAgICAgIH0KCiAgICAgIHZhciBjaGF0ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5maW5kKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgcmV0dXJuIGMuSWQgPT09IGNoYXRJZDsKICAgICAgfSk7CgogICAgICBpZiAoY2hhdCkgewogICAgICAgIGlmICghY2hhdC5TdWJzY3JpYmVyc0NvdW50KSB7CiAgICAgICAgICBjaGF0LlN1YnNjcmliZXJzQ291bnQgPSAwOwogICAgICAgIH0KCiAgICAgICAgY2hhdC5TdWJzY3JpYmVyc0NvdW50LS07CiAgICAgIH0KICAgIH0sCiAgICBtc2dfcmVtb3ZlRnJvbUJsb2NrbGlzdDogZnVuY3Rpb24gbXNnX3JlbW92ZUZyb21CbG9ja2xpc3Qoc3RhdGUsIF9yZWY2KSB7CiAgICAgIHZhciBDaGF0SWQgPSBfcmVmNi5DaGF0SWQsCiAgICAgICAgICBBY2NvdW50SWQgPSBfcmVmNi5BY2NvdW50SWQ7CiAgICAgIHZhciBjaGF0ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5maW5kKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgcmV0dXJuIGMuSWQgPT09IENoYXRJZDsKICAgICAgfSk7CiAgICAgIGlmICghY2hhdCkgcmV0dXJuOwogICAgICB2YXIgYmxvY2tJZHggPSBjaGF0LkJsb2NrSXRlbXMuZmluZEluZGV4KGZ1bmN0aW9uIChiKSB7CiAgICAgICAgcmV0dXJuIGIuQWNjb3VudElkID09PSBBY2NvdW50SWQ7CiAgICAgIH0pOwogICAgICBpZiAoYmxvY2tJZHggPT09IC0xKSByZXR1cm47CiAgICAgIGNoYXQuQmxvY2tJdGVtcy5zcGxpY2UoYmxvY2tJZHgsIDEpOwoKICAgICAgaWYgKHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSWQgPT09IENoYXRJZCkgewogICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuQmxvY2tJdGVtcyA9IGNoYXQuQmxvY2tJdGVtczsKICAgICAgfQogICAgfSwKICAgIG1zZ19hZGRCbG9ja2xpc3RJdGVtczogZnVuY3Rpb24gbXNnX2FkZEJsb2NrbGlzdEl0ZW1zKHN0YXRlLCBfcmVmNykgewogICAgICB2YXIgQ2hhdElkID0gX3JlZjcuQ2hhdElkLAogICAgICAgICAgQmxvY2tJdGVtcyA9IF9yZWY3LkJsb2NrSXRlbXM7CiAgICAgIHZhciBjaGF0ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5maW5kKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgcmV0dXJuIGMuSWQgPT09IENoYXRJZDsKICAgICAgfSk7CgogICAgICBpZiAoY2hhdCkgewogICAgICAgIGlmICghY2hhdC5CbG9ja0l0ZW1zKSBjaGF0LkJsb2NrSXRlbXMgPSBbXTsKICAgICAgICBCbG9ja0l0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICAgIGlmICghY2hhdC5CbG9ja0l0ZW1zLmZpbmQoZnVuY3Rpb24gKGJpKSB7CiAgICAgICAgICAgIHJldHVybiBiaS5JZCA9PT0gaS5JZDsKICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgIGNoYXQuQmxvY2tJdGVtcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAoc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5JZCA9PT0gQ2hhdElkKSB7CiAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5CbG9ja0l0ZW1zID0gY2hhdC5CbG9ja0l0ZW1zOwogICAgICB9CiAgICB9LAogICAgbXNnX3NldENoYXRJc09ubGluZTogZnVuY3Rpb24gbXNnX3NldENoYXRJc09ubGluZShzdGF0ZSwgX3JlZjgpIHsKICAgICAgdmFyIENoYXRJZCA9IF9yZWY4LkNoYXRJZCwKICAgICAgICAgIElzT25saW5lID0gX3JlZjguSXNPbmxpbmU7CiAgICAgIHZhciBjaGF0ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5maW5kKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgcmV0dXJuIGMuSWQgPT09IENoYXRJZDsKICAgICAgfSk7CgogICAgICBpZiAoY2hhdCkgewogICAgICAgIGNoYXQuSXNPbmxpbmUgPSBJc09ubGluZTsKICAgICAgfQoKICAgICAgaWYgKHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSWQgPT09IENoYXRJZCkgewogICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSXNPbmxpbmUgPSBjaGF0LklzT25saW5lOwogICAgICB9CiAgICB9LAogICAgLy8jZW5kcmVnaW9uIE1zZyBDaGF0cwogICAgbXNnX3NldFZpZXdlZFByb2ZpbGVJbmZvOiBmdW5jdGlvbiBtc2dfc2V0Vmlld2VkUHJvZmlsZUluZm8oc3RhdGUsIGluZm8pIHsKICAgICAgaW5mby5Jc0luQ29udGFjdHMgPSBmYWxzZTsKICAgICAgdmFyIGNvbnRhY3QgPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNvbnRhY3RzLmZpbmQoZnVuY3Rpb24gKGMpIHsKICAgICAgICByZXR1cm4gYy5BY2NvdW50SWQgPT09IGluZm8uSWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKGNvbnRhY3QpIHsKICAgICAgICBpbmZvLkRpc3BsYXllZE5hbWUgPSBjb250YWN0Lk5hbWU7CiAgICAgICAgaW5mby5Jc0luQ29udGFjdHMgPSB0cnVlOwogICAgICB9CgogICAgICBpbmZvLmlzTG9hZGluZyA9IGZhbHNlOwogICAgICBpbmZvLkxhc3RWaXNpdFRpbWUgKj0gMTAwMDsKICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS52aWV3ZWRQcm9maWxlID0gaW5mbzsKICAgIH0sCiAgICBtc2dfc2V0QWNjb3VudERpc3BsYXllZE5hbWU6IGZ1bmN0aW9uIG1zZ19zZXRBY2NvdW50RGlzcGxheWVkTmFtZShzdGF0ZSwgX3JlZjkpIHsKICAgICAgdmFyIG5ld0Rpc3BsYXllZE5hbWUgPSBfcmVmOS5uZXdEaXNwbGF5ZWROYW1lOwogICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRBY2NvdW50LkRpc3BsYXllZE5hbWUgPSBuZXdEaXNwbGF5ZWROYW1lOwogICAgfSwKICAgIG1zZ19zZXRBY2NvdW50SXNOdW1iZXJIaWRlZDogZnVuY3Rpb24gbXNnX3NldEFjY291bnRJc051bWJlckhpZGVkKHN0YXRlLCBpc051bWJlckhpZGVkKSB7CiAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudEFjY291bnQuSXNOdW1iZXJIaWRlZCA9IGlzTnVtYmVySGlkZWQ7CiAgICB9CiAgfSwKICBhY3Rpb25zOiB7CiAgICBjaGVja0NoYXRJc0xvYWRpbmc6IGZ1bmN0aW9uIGNoZWNrQ2hhdElzTG9hZGluZyhfcmVmMTApIHsKICAgICAgdmFyIHN0YXRlID0gX3JlZjEwLnN0YXRlLAogICAgICAgICAgZGlzcGF0Y2ggPSBfcmVmMTAuZGlzcGF0Y2g7CgogICAgICBpZiAoc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5Jc0xvYWRpbmcpIHsKICAgICAgICBkaXNwYXRjaCgnc21hcnRwaG9uZS9zZXRUYWJPckJhY2snLCB7CiAgICAgICAgICBrZXk6ICdNZXNzZW5nZXJUYWInLAogICAgICAgICAgc2VjdGlvbjogJ0dlbmVyYWxTZWN0aW9uJywKICAgICAgICAgIHN1YnNlY3Rpb246ICdHZW5lcmFsU3Vic2VjdGlvbicsCiAgICAgICAgICBkYXRhOiBudWxsCiAgICAgICAgfSwgewogICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSXNMb2FkaW5nID0gZmFsc2U7CiAgICAgIH0gZWxzZSBpZiAoc3RhdGUubWVzc2VuZ2VyRGF0YS52aWV3ZWRQcm9maWxlLklzTG9hZGluZykgewogICAgICAgIGRpc3BhdGNoKCdzbWFydHBob25lL3NldFRhYk9yQmFjaycsIHsKICAgICAgICAgIGtleTogJ01lc3NlbmdlclRhYicsCiAgICAgICAgICBzZWN0aW9uOiAnR2VuZXJhbFNlY3Rpb24nLAogICAgICAgICAgc3Vic2VjdGlvbjogJ0dlbmVyYWxTdWJzZWN0aW9uJywKICAgICAgICAgIGRhdGE6IG51bGwKICAgICAgICB9LCB7CiAgICAgICAgICByb290OiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS52aWV3ZWRQcm9maWxlLklzTG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgbXNnX2Ryb3BDdXJyZW50Q2hhdDogZnVuY3Rpb24gbXNnX2Ryb3BDdXJyZW50Q2hhdChfcmVmMTEpIHsKICAgICAgdmFyIHN0YXRlID0gX3JlZjExLnN0YXRlOwogICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklkID0gLTE7CiAgICB9LAogICAgbXNnX3NldEFkbWluc0ZvckN1cnJlbnRDaGF0OiBmdW5jdGlvbiBtc2dfc2V0QWRtaW5zRm9yQ3VycmVudENoYXQoX3JlZjEyLCBhZG1pbnMpIHsKICAgICAgdmFyIHN0YXRlID0gX3JlZjEyLnN0YXRlOwogICAgICB2YXIgY2hhdElkID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5JZDsKICAgICAgdmFyIGNoYXQgPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNoYXRzLmZpbmQoZnVuY3Rpb24gKGMpIHsKICAgICAgICByZXR1cm4gYy5JZCA9PT0gY2hhdElkOwogICAgICB9KTsKCiAgICAgIGlmICghY2hhdCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5BZG1pbnMgPSBhZG1pbnM7CiAgICAgIGNoYXQuQWRtaW5zID0gYWRtaW5zOwogICAgfSwKICAgIG1zZ19hZGRBZG1pbkZvckNoYXQ6IGZ1bmN0aW9uIG1zZ19hZGRBZG1pbkZvckNoYXQoX3JlZjEzLCBfcmVmMTQpIHsKICAgICAgdmFyIHN0YXRlID0gX3JlZjEzLnN0YXRlOwogICAgICB2YXIgQ2hhdElkID0gX3JlZjE0LkNoYXRJZCwKICAgICAgICAgIEFjY291bnRJZCA9IF9yZWYxNC5BY2NvdW50SWQ7CiAgICAgIHZhciBzdWJzY3JpYmVyID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5TZWFyY2hTdWJzY3JpYmVycy5maW5kKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgcmV0dXJuIHMuSWQgPT09IEFjY291bnRJZDsKICAgICAgfSk7CiAgICAgIGlmICghc3Vic2NyaWJlcikgcmV0dXJuOwogICAgICB2YXIgY2hhdCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMuZmluZChmdW5jdGlvbiAoYykgewogICAgICAgIHJldHVybiBjLklkID09PSBDaGF0SWQ7CiAgICAgIH0pOwogICAgICBpZiAoIWNoYXQpIHJldHVybjsKICAgICAgc3Vic2NyaWJlci5BZG1pbkx2bCA9IDE7CiAgICAgIHN1YnNjcmliZXIuUGVybWlzc2lvbnMgPSBbXTsKICAgICAgY2hhdC5BZG1pbnMucHVzaChzdWJzY3JpYmVyKTsKCiAgICAgIGlmIChzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklkID09PSBDaGF0SWQpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LkFkbWlucy5wdXNoKHN1YnNjcmliZXIpOwogICAgICB9CiAgICB9LAogICAgbXNnX2RlbGV0ZUFkbWluRm9yQ2hhdDogZnVuY3Rpb24gbXNnX2RlbGV0ZUFkbWluRm9yQ2hhdChfcmVmMTUsIF9yZWYxNikgewogICAgICB2YXIgc3RhdGUgPSBfcmVmMTUuc3RhdGU7CiAgICAgIHZhciBDaGF0SWQgPSBfcmVmMTYuQ2hhdElkLAogICAgICAgICAgQWRtaW5JZCA9IF9yZWYxNi5BZG1pbklkOwogICAgICB2YXIgY2hhdCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMuZmluZChmdW5jdGlvbiAoYykgewogICAgICAgIHJldHVybiBjLklkID09PSBDaGF0SWQ7CiAgICAgIH0pOwogICAgICBpZiAoIWNoYXQpIHJldHVybjsKICAgICAgdmFyIGFkbWluSWR4ID0gY2hhdC5BZG1pbnMuZmluZEluZGV4KGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEuSWQgPT09IEFkbWluSWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKGFkbWluSWR4ICE9PSAtMSkgewogICAgICAgIGNoYXQuQWRtaW5zLnNwbGljZShhZG1pbklkeCwgMSk7CiAgICAgIH0KCiAgICAgIGlmIChzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklkID09PSBDaGF0SWQpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LkFkbWlucyA9IGNoYXQuQWRtaW5zOwogICAgICB9CiAgICB9LAogICAgbXNnX3NldE15QWRtaW5QZXJtaXNzaW9uc0ZvckNoYXQ6IGZ1bmN0aW9uIG1zZ19zZXRNeUFkbWluUGVybWlzc2lvbnNGb3JDaGF0KF9yZWYxNywgX3JlZjE4KSB7CiAgICAgIHZhciBzdGF0ZSA9IF9yZWYxNy5zdGF0ZTsKICAgICAgdmFyIENoYXRJZCA9IF9yZWYxOC5DaGF0SWQsCiAgICAgICAgICBBZG1pbkx2bCA9IF9yZWYxOC5BZG1pbkx2bCwKICAgICAgICAgIFBlcm1pc3Npb25zID0gX3JlZjE4LlBlcm1pc3Npb25zOwogICAgICB2YXIgY2hhdCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMuZmluZChmdW5jdGlvbiAoYykgewogICAgICAgIHJldHVybiBjLklkID09PSBDaGF0SWQ7CiAgICAgIH0pOwogICAgICBpZiAoIWNoYXQpIHJldHVybjsKICAgICAgY2hhdC5QZXJtaXNzaW9ucyA9IFBlcm1pc3Npb25zOwogICAgICBjaGF0LkFkbWluTHZsID0gQWRtaW5Mdmw7CiAgICB9LAogICAgbXNnX29wZW5DaGF0OiBmdW5jdGlvbiBtc2dfb3BlbkNoYXQoX3JlZjE5LCBjaGF0SWQpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYxOS5jb21taXQsCiAgICAgICAgICBzdGF0ZSA9IF9yZWYxOS5zdGF0ZTsKICAgICAgdmFyIGNoYXQgPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNoYXRzLmZpbmQoZnVuY3Rpb24gKGMpIHsKICAgICAgICByZXR1cm4gYy5JZCA9PT0gY2hhdElkOwogICAgICB9KTsKICAgICAgdmFyIHN1YnNlY3Rpb25zQnlDaGF0VHlwZSA9IHsKICAgICAgICAwOiAnUHJpdmF0ZVN1YnNlY3Rpb24nLAogICAgICAgIDE6ICdHcm91cFN1YnNlY3Rpb24nLAogICAgICAgIDI6ICdDYW5hbFN1YnNlY3Rpb24nCiAgICAgIH07CiAgICAgIGNvbW1pdCgnbXNnX3NldEN1cnJlbnRDaGF0JywgY2hhdCk7IC8vIElzQWxyZWFkeUxvYWRlZCAtINGDINC40LPRgNC+0LrQsCDRg9C20LUg0L/QvtC00LPRgNGD0LbQtdC90Ysg0L/QvtGB0LvQtdC00L3QuNC1INGB0L7QvtCx0YnQtdC90LjRjyDQsiDRh9Cw0YLQtQoKICAgICAgaWYgKGNoYXQuSXNBbHJlYWR5TG9hZGVkKSB7CiAgICAgICAgdmFyIG1lc3NhZ2VzID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5fY2FjaGVkTWVzc2FnZXMuZmlsdGVyKGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICByZXR1cm4gbS5DaGF0SWQgPT09IGNoYXRJZDsKICAgICAgICB9KTsKCiAgICAgICAgY29tbWl0KCdtc2dfc2V0Q3VycmVudENoYXRNZXNzYWdlcycsIG1lc3NhZ2VzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cubXAudHJpZ2dlclNlcnZlcigncGhvbmU6Om1zZzo6cmVxdWVzdENoYXQnLCBjaGF0SWQpOwogICAgICAgIGNvbW1pdCgnbXNnX3NldEN1cnJlbnRDaGF0SXNMb2FkaW5nJywgdHJ1ZSk7CiAgICAgIH0KCiAgICAgIGNvbW1pdCgnc21hcnRwaG9uZS9zZXRDdXJyZW50VGFiJywgewogICAgICAgIGtleTogJ01lc3NlbmdlclRhYicsCiAgICAgICAgc2VjdGlvbjogJ0NoYXRTZWN0aW9uJywKICAgICAgICBzdWJzZWN0aW9uOiBzdWJzZWN0aW9uc0J5Q2hhdFR5cGVbY2hhdC5UeXBlXSwKICAgICAgICBkYXRhOiBudWxsCiAgICAgIH0sIHsKICAgICAgICByb290OiB0cnVlCiAgICAgIH0pOwoKICAgICAgaWYgKGNoYXQuTm9uUmVhZE1lc3NhZ2VzQ291bnQgPiAwKSB7CiAgICAgICAgd2luZG93Lm1wLnRyaWdnZXJTZXJ2ZXIoJ3Bob25lOjptc2c6Om1hcmtBc1JlYWQnLCBjaGF0SWQpOwogICAgICB9CiAgICB9LAogICAgbXNnX29wZW5Qcml2YXRlQ2hhdDogZnVuY3Rpb24gbXNnX29wZW5Qcml2YXRlQ2hhdChfcmVmMjAsIGFjY291bnRJZCkgewogICAgICB2YXIgZGlzcGF0Y2ggPSBfcmVmMjAuZGlzcGF0Y2gsCiAgICAgICAgICBjb21taXQgPSBfcmVmMjAuY29tbWl0LAogICAgICAgICAgc3RhdGUgPSBfcmVmMjAuc3RhdGU7CiAgICAgIHZhciBwcml2YXRlQ2hhdCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ2hhdHMuZmluZChmdW5jdGlvbiAoYykgewogICAgICAgIHJldHVybiBjLkFjY291bnRJZCA9PT0gYWNjb3VudElkOwogICAgICB9KTsKCiAgICAgIGlmIChwcml2YXRlQ2hhdCkgewogICAgICAgIGRpc3BhdGNoKCdtc2dfb3BlbkNoYXQnLCBwcml2YXRlQ2hhdC5JZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29tbWl0KCdtc2dfc2V0Q3VycmVudENoYXRJc0xvYWRpbmcnLCB0cnVlKTsKICAgICAgICBjb21taXQoJ21zZ19zZXRDdXJyZW50Q2hhdCcsIHsKICAgICAgICAgIElkOiAtMSwKICAgICAgICAgIE5hbWU6ICdQcml2YXRlIENoYXQnLAogICAgICAgICAgSXNPbmxpbmU6IGZhbHNlLAogICAgICAgICAgVHlwZTogMCwKICAgICAgICAgIEFjY291bnRJZDogYWNjb3VudElkCiAgICAgICAgfSk7CiAgICAgICAgd2luZG93Lm1wLnRyaWdnZXJTZXJ2ZXIoJ3Bob25lOjptc2c6OmNyZWF0ZVByaXZhdGVDaGF0JywgYWNjb3VudElkKTsKICAgICAgICBjb21taXQoJ3NtYXJ0cGhvbmUvc2V0Q3VycmVudFRhYicsIHsKICAgICAgICAgIGtleTogJ01lc3NlbmdlclRhYicsCiAgICAgICAgICBzZWN0aW9uOiAnQ2hhdFNlY3Rpb24nLAogICAgICAgICAgc3Vic2VjdGlvbjogJ1ByaXZhdGVTdWJzZWN0aW9uJywKICAgICAgICAgIGRhdGE6IG51bGwKICAgICAgICB9LCB7CiAgICAgICAgICByb290OiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBtc2dfbG9hZEluY2hhdEluZm86IGZ1bmN0aW9uIG1zZ19sb2FkSW5jaGF0SW5mbyhfcmVmMjEsIF9yZWYyMikgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjIxLmNvbW1pdCwKICAgICAgICAgIHN0YXRlID0gX3JlZjIxLnN0YXRlOwogICAgICB2YXIgQ2hhdElkID0gX3JlZjIyLkNoYXRJZCwKICAgICAgICAgIFN1YnNjcmliZXJzQ291bnQgPSBfcmVmMjIuU3Vic2NyaWJlcnNDb3VudCwKICAgICAgICAgIE1lc3NhZ2VzID0gX3JlZjIyLk1lc3NhZ2VzLAogICAgICAgICAgUGVybWlzc2lvbnMgPSBfcmVmMjIuUGVybWlzc2lvbnMsCiAgICAgICAgICBBZG1pbkx2bCA9IF9yZWYyMi5BZG1pbkx2bCwKICAgICAgICAgIEludml0ZUNvZGUgPSBfcmVmMjIuSW52aXRlQ29kZTsKICAgICAgTWVzc2FnZXMuZm9yRWFjaChmdW5jdGlvbiAobWVzc2FnZSkgewogICAgICAgIG1lc3NhZ2UuVGltZSAqPSAxMDAwOwogICAgICAgIG1lc3NhZ2UuQ2hhdElkID0gQ2hhdElkOwogICAgICAgIGNvbW1pdCgnbXNnX2NhY2hlTWVzc2FnZScsIG1lc3NhZ2UpOwogICAgICB9KTsKICAgICAgdmFyIGNoYXQgPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNoYXRzLmZpbmQoZnVuY3Rpb24gKGMpIHsKICAgICAgICByZXR1cm4gYy5JZCA9PT0gQ2hhdElkOwogICAgICB9KTsKICAgICAgY2hhdC5TdWJzY3JpYmVyc0NvdW50ID0gU3Vic2NyaWJlcnNDb3VudDsKICAgICAgY2hhdC5QZXJtaXNzaW9ucyA9IFBlcm1pc3Npb25zOwogICAgICBjaGF0LklzQWxyZWFkeUxvYWRlZCA9IHRydWU7CiAgICAgIGNoYXQuQWRtaW5MdmwgPSBBZG1pbkx2bDsKICAgICAgY2hhdC5JbnZpdGVDb2RlID0gSW52aXRlQ29kZTsKICAgICAgY29tbWl0KCdtc2dfc2V0Q3VycmVudENoYXQnLCBjaGF0KTsKICAgICAgY29tbWl0KCdtc2dfc2V0Q3VycmVudENoYXRNZXNzYWdlcycsIE1lc3NhZ2VzKTsgLy8g0J/QvtC00LPRgNGD0LfQutCwINC90LXQt9Cw0LrQtdGI0LjRgNC+0LLQsNC90L3Ri9GFINCw0LrQutCw0YPQvdGC0L7QsgoKICAgICAgdmFyIHNlbmRlcnNJZHMgPSBfdG9Db25zdW1hYmxlQXJyYXkobmV3IFNldChNZXNzYWdlcy5tYXAoZnVuY3Rpb24gKG0pIHsKICAgICAgICByZXR1cm4gbS5TZW5kZXJJZDsKICAgICAgfSkpKTsKCiAgICAgIHZhciBub25DYWNoZWRBY2NvdW50c0lkcyA9IHNlbmRlcnNJZHMuZmlsdGVyKGZ1bmN0aW9uIChhY2NvdW50SWQpIHsKICAgICAgICByZXR1cm4gIXN0YXRlLm1lc3NlbmdlckRhdGEuX2NhY2hlZEFjY291bnRzLmZpbmQoZnVuY3Rpb24gKGEpIHsKICAgICAgICAgIHJldHVybiBhLklkID09PSBhY2NvdW50SWQ7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB3aW5kb3cubXAudHJpZ2dlclNlcnZlcigncGhvbmU6Om1zZzo6cmVxdWVzdEFjY291bnRzTmFtZXMnLCBKU09OLnN0cmluZ2lmeShub25DYWNoZWRBY2NvdW50c0lkcykpOwogICAgfSwKICAgIG1zZ19vcGVuQWNjb3VudDogZnVuY3Rpb24gbXNnX29wZW5BY2NvdW50KF9yZWYyMywgYWNjb3VudElkKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmMjMuY29tbWl0LAogICAgICAgICAgc3RhdGUgPSBfcmVmMjMuc3RhdGU7CiAgICAgIHZhciBjb250YWN0ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5Db250YWN0cy5maW5kKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgcmV0dXJuIGMuQWNjb3VudElkID09PSBhY2NvdW50SWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKGNvbnRhY3QpIHsKICAgICAgICBjb25zb2xlLmxvZygiIi5jb25jYXQoYWNjb3VudElkKSk7CiAgICAgIH0KCiAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEudmlld2VkUHJvZmlsZS5pc0xvYWRpbmcgPSB0cnVlOwogICAgICB3aW5kb3cubXAudHJpZ2dlclNlcnZlcigncGhvbmU6Om1zZzo6cmVxdWVzdEFjY291bnQnLCBhY2NvdW50SWQpOwogICAgICBjb21taXQoJ3NtYXJ0cGhvbmUvc2V0Q3VycmVudFRhYicsIHsKICAgICAgICBrZXk6ICdNZXNzZW5nZXJUYWInLAogICAgICAgIHNlY3Rpb246ICdWaWV3ZWRQcm9maWxlU2VjdGlvbicsCiAgICAgICAgZGF0YTogbnVsbAogICAgICB9LCB7CiAgICAgICAgcm9vdDogdHJ1ZQogICAgICB9KTsKICAgIH0sCiAgICBtc2dfc2V0QWNjb3VudEFuZENoYXRNdXRlZDogZnVuY3Rpb24gbXNnX3NldEFjY291bnRBbmRDaGF0TXV0ZWQoX3JlZjI0LCBfcmVmMjUpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYyNC5jb21taXQsCiAgICAgICAgICBzdGF0ZSA9IF9yZWYyNC5zdGF0ZTsKICAgICAgdmFyIENoYXRJZCA9IF9yZWYyNS5DaGF0SWQsCiAgICAgICAgICBBY2NvdW50SWQgPSBfcmVmMjUuQWNjb3VudElkLAogICAgICAgICAgSXNNdXRlZCA9IF9yZWYyNS5Jc011dGVkOwogICAgICBjb21taXQoJ21zZ19zZXRDaGF0TXV0ZWQnLCB7CiAgICAgICAgQ2hhdElkOiBDaGF0SWQsCiAgICAgICAgSXNNdXRlZDogSXNNdXRlZAogICAgICB9KTsKCiAgICAgIGlmIChzdGF0ZS5tZXNzZW5nZXJEYXRhLnZpZXdlZFByb2ZpbGUuSWQgPT09IEFjY291bnRJZCkgewogICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEudmlld2VkUHJvZmlsZS5Jc011dGVkID0gSXNNdXRlZDsKICAgICAgfQogICAgfSwKICAgIG1zZ19zZXRBY2NvdW50QmxvY2tlZDogZnVuY3Rpb24gbXNnX3NldEFjY291bnRCbG9ja2VkKF9yZWYyNiwgX3JlZjI3KSB7CiAgICAgIHZhciBzdGF0ZSA9IF9yZWYyNi5zdGF0ZTsKICAgICAgdmFyIEFjY291bnRJZCA9IF9yZWYyNy5BY2NvdW50SWQsCiAgICAgICAgICBJc0Jsb2NrZWQgPSBfcmVmMjcuSXNCbG9ja2VkOwoKICAgICAgaWYgKHN0YXRlLm1lc3NlbmdlckRhdGEudmlld2VkUHJvZmlsZS5JZCA9PT0gQWNjb3VudElkKSB7CiAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS52aWV3ZWRQcm9maWxlLklzQmxvY2tlZCA9IElzQmxvY2tlZDsKICAgICAgfQogICAgfSwKICAgIG1zZ19yZW1vdmVDb250YWN0OiBmdW5jdGlvbiBtc2dfcmVtb3ZlQ29udGFjdChfcmVmMjgsIF9yZWYyOSkgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjI4LmNvbW1pdCwKICAgICAgICAgIHN0YXRlID0gX3JlZjI4LnN0YXRlOwogICAgICB2YXIgQ29udGFjdElkID0gX3JlZjI5LkNvbnRhY3RJZCwKICAgICAgICAgIEFjY291bnREaXNwbGF5ZWROYW1lID0gX3JlZjI5LkFjY291bnREaXNwbGF5ZWROYW1lOwogICAgICB2YXIgY29udGFjdCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ29udGFjdHMuZmluZChmdW5jdGlvbiAoYykgewogICAgICAgIHJldHVybiBjLklkID09PSBDb250YWN0SWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKGNvbnRhY3QpIHsKICAgICAgICB2YXIgcHJpdmF0ZUNoYXQgPSBzdGF0ZS5tZXNzZW5nZXJEYXRhLkNoYXRzLmZpbmQoZnVuY3Rpb24gKGMpIHsKICAgICAgICAgIHJldHVybiBjLkFjY291bnRJZCA9PSBjb250YWN0LkFjY291bnRJZDsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHByaXZhdGVDaGF0KSB7CiAgICAgICAgICBjb21taXQoJ21zZ19yZW5hbWVDaGF0JywgewogICAgICAgICAgICBDaGF0SWQ6IHByaXZhdGVDaGF0LklkLAogICAgICAgICAgICBOYW1lOiBBY2NvdW50RGlzcGxheWVkTmFtZQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoc3RhdGUubWVzc2VuZ2VyRGF0YS52aWV3ZWRQcm9maWxlLklkID09PSBjb250YWN0LkFjY291bnRJZCkgewogICAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS52aWV3ZWRQcm9maWxlLkRpc3BsYXllZE5hbWUgPSBBY2NvdW50RGlzcGxheWVkTmFtZTsKICAgICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEudmlld2VkUHJvZmlsZS5Jc0luQ29udGFjdHMgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbW1pdCgnbXNnX3JlbW92ZVN0b3JlQ29udGFjdCcsIENvbnRhY3RJZCk7CiAgICB9LAogICAgbXNnX2FkZENvbnRhY3Q6IGZ1bmN0aW9uIG1zZ19hZGRDb250YWN0KF9yZWYzMCwgY29udGFjdCkgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjMwLmNvbW1pdCwKICAgICAgICAgIHN0YXRlID0gX3JlZjMwLnN0YXRlOwoKICAgICAgaWYgKHN0YXRlLm1lc3NlbmdlckRhdGEudmlld2VkUHJvZmlsZS5JZCA9PT0gY29udGFjdC5BY2NvdW50SWQpIHsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLnZpZXdlZFByb2ZpbGUuRGlzcGxheWVkTmFtZSA9IGNvbnRhY3QuTmFtZTsKICAgICAgICBzdGF0ZS5tZXNzZW5nZXJEYXRhLnZpZXdlZFByb2ZpbGUuSXNJbkNvbnRhY3RzID0gdHJ1ZTsKICAgICAgfQoKICAgICAgY29tbWl0KCdtc2dfbG9hZENvbnRhY3RzJywgW2NvbnRhY3RdKTsKICAgIH0sCiAgICBtc2dfbG9hZENoYXQ6IGZ1bmN0aW9uIG1zZ19sb2FkQ2hhdChfcmVmMzEsIGNoYXQpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYzMS5jb21taXQsCiAgICAgICAgICBzdGF0ZSA9IF9yZWYzMS5zdGF0ZTsKCiAgICAgIGlmICghY2hhdC5TdWJzY3JpYmVyc0NvdW50KSB7CiAgICAgICAgY2hhdC5TdWJzY3JpYmVyc0NvdW50ID0gMDsKICAgICAgfQoKICAgICAgY29tbWl0KCdtc2dfbG9hZENoYXRzJywgW2NoYXRdKTsKCiAgICAgIGlmIChzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklkID09PSAtMSB8fCBzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklkID09PSBjaGF0LklkKSB7CiAgICAgICAgd2luZG93Lm1wLnRyaWdnZXJTZXJ2ZXIoJ3Bob25lOjptc2c6OnJlcXVlc3RDaGF0JywgY2hhdC5JZCk7CiAgICAgIH0KICAgIH0sCiAgICBtc2dfY3JlYXRlQ2hhdDogZnVuY3Rpb24gbXNnX2NyZWF0ZUNoYXQoX3JlZjMyLCBfcmVmMzMpIHsKICAgICAgdmFyIGNvbW1pdCA9IF9yZWYzMi5jb21taXQ7CiAgICAgIHZhciBDaGF0VHlwZSA9IF9yZWYzMy5DaGF0VHlwZSwKICAgICAgICAgIE5hbWUgPSBfcmVmMzMuTmFtZSwKICAgICAgICAgIERlc2NyaXB0aW9uID0gX3JlZjMzLkRlc2NyaXB0aW9uLAogICAgICAgICAgSWNvbkNvbG9ycyA9IF9yZWYzMy5JY29uQ29sb3JzLAogICAgICAgICAgVXNlcnNUb0ludml0ZSA9IF9yZWYzMy5Vc2Vyc1RvSW52aXRlOwogICAgICBjb21taXQoJ21zZ19zZXRDdXJyZW50Q2hhdCcsIHsKICAgICAgICBJZDogLTEsCiAgICAgICAgTmFtZTogTmFtZSwKICAgICAgICBJc09ubGluZTogZmFsc2UsCiAgICAgICAgVHlwZTogQ2hhdFR5cGUsCiAgICAgICAgSWNvbkNvbG9yczogSWNvbkNvbG9ycywKICAgICAgICBTdWJzY3JpYmVyc0NvdW50OiAwCiAgICAgIH0pOwogICAgICB2YXIgc3Vic2VjdGlvbnNCeUNoYXRUeXBlID0gewogICAgICAgIDA6ICdQcml2YXRlU3Vic2VjdGlvbicsCiAgICAgICAgMTogJ0dyb3VwU3Vic2VjdGlvbicsCiAgICAgICAgMjogJ0NhbmFsU3Vic2VjdGlvbicKICAgICAgfTsKICAgICAgY29tbWl0KCdzbWFydHBob25lL3NldEN1cnJlbnRUYWInLCB7CiAgICAgICAga2V5OiAnTWVzc2VuZ2VyVGFiJywKICAgICAgICBzZWN0aW9uOiAnQ2hhdFNlY3Rpb24nLAogICAgICAgIHN1YnNlY3Rpb246IHN1YnNlY3Rpb25zQnlDaGF0VHlwZVtDaGF0VHlwZV0sCiAgICAgICAgZGF0YTogbnVsbAogICAgICB9LCB7CiAgICAgICAgcm9vdDogdHJ1ZQogICAgICB9KTsKICAgICAgY29tbWl0KCdtc2dfc2V0Q3VycmVudENoYXRJc0xvYWRpbmcnLCB0cnVlKTsKCiAgICAgIGlmIChDaGF0VHlwZSA9PT0gMSkgewogICAgICAgIHdpbmRvdy5tcC50cmlnZ2VyU2VydmVyKCdwaG9uZTo6bXNnOjpjcmVhdGVHcm91cENoYXQnLCBOYW1lLCBEZXNjcmlwdGlvbiwgSWNvbkNvbG9ycywgSlNPTi5zdHJpbmdpZnkoVXNlcnNUb0ludml0ZSkpOwogICAgICB9IGVsc2UgaWYgKENoYXRUeXBlID09PSAyKSB7CiAgICAgICAgd2luZG93Lm1wLnRyaWdnZXJTZXJ2ZXIoJ3Bob25lOjptc2c6OmNyZWF0ZUNoYW5uZWwnLCBOYW1lLCBEZXNjcmlwdGlvbiwgSWNvbkNvbG9ycyk7CiAgICAgIH0KICAgIH0sCiAgICBtc2dfc2VuZE1lc3NhZ2U6IGZ1bmN0aW9uIG1zZ19zZW5kTWVzc2FnZShfcmVmMzQsIF9yZWYzNSkgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjM0LmNvbW1pdCwKICAgICAgICAgIHN0YXRlID0gX3JlZjM0LnN0YXRlLAogICAgICAgICAgZGlzcGF0Y2ggPSBfcmVmMzQuZGlzcGF0Y2g7CiAgICAgIHZhciBDaGF0SWQgPSBfcmVmMzUuQ2hhdElkLAogICAgICAgICAgTWVzc2FnZSA9IF9yZWYzNS5NZXNzYWdlOwogICAgICBNZXNzYWdlLkNoYXRJZCA9IENoYXRJZDsKICAgICAgTWVzc2FnZS5UaW1lICo9IDEwMDA7CiAgICAgIGNvbW1pdCgnbXNnX2NhY2hlTWVzc2FnZScsIE1lc3NhZ2UpOwogICAgICBjb21taXQoJ21zZ19zZXRMYXN0TWVzc2FnZScsIE1lc3NhZ2UpOwoKICAgICAgaWYgKCFzdGF0ZS5tZXNzZW5nZXJEYXRhLl9jYWNoZWRBY2NvdW50cy5maW5kKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgcmV0dXJuIGEuSWQgPT09IE1lc3NhZ2UuU2VuZGVySWQ7CiAgICAgIH0pKSB7CiAgICAgICAgd2luZG93Lm1wLnRyaWdnZXJTZXJ2ZXIoJ3Bob25lOjptc2c6OnJlcXVlc3RBY2NvdW50c05hbWVzJywgIlsiLmNvbmNhdChNZXNzYWdlLlNlbmRlcklkLCAiXSIpKTsKICAgICAgfQoKICAgICAgaWYgKHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSWQgPT09IENoYXRJZCkgewogICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSXRlbXMucHVzaChNZXNzYWdlKTsKCiAgICAgICAgaWYgKE1lc3NhZ2UuU2VuZGVySWQgIT09IHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudEFjY291bnQuSWQpIHsKICAgICAgICAgIHdpbmRvdy5tcC50cmlnZ2VyU2VydmVyKCdwaG9uZTo6bXNnOjptYXJrQXNSZWFkJywgQ2hhdElkKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoTWVzc2FnZS5TZW5kZXJJZCAhPT0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50QWNjb3VudC5JZCkgewogICAgICAgIHZhciBjaGF0ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5maW5kKGZ1bmN0aW9uIChjKSB7CiAgICAgICAgICByZXR1cm4gYy5JZCA9PT0gQ2hhdElkOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY2hhdCkgewogICAgICAgICAgY2hhdC5Ob25SZWFkTWVzc2FnZXNDb3VudCsrOwoKICAgICAgICAgIGlmICghY2hhdC5Jc011dGVkKSB7CiAgICAgICAgICAgIGRpc3BhdGNoKCdzbWFydHBob25lL3NvdW5kc19wbGF5Tm90aWZpY2F0aW9uJywgewogICAgICAgICAgICAgIHJvb3Q6IHRydWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgbXNnX2RlbGV0ZU1lc3NhZ2U6IGZ1bmN0aW9uIG1zZ19kZWxldGVNZXNzYWdlKF9yZWYzNiwgTWVzc2FnZUlkKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmMzYuY29tbWl0LAogICAgICAgICAgc3RhdGUgPSBfcmVmMzYuc3RhdGU7CiAgICAgIGNvbW1pdCgnbXNnX3VuY2FjaGVNZXNzYWdlJywgTWVzc2FnZUlkKTsKCiAgICAgIGlmIChzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0Lkl0ZW1zKSB7CiAgICAgICAgdmFyIG1zZ0lkeCA9IHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSXRlbXMuZmluZEluZGV4KGZ1bmN0aW9uIChtKSB7CiAgICAgICAgICByZXR1cm4gbS5JZCA9PT0gTWVzc2FnZUlkOwogICAgICAgIH0pOwoKICAgICAgICBpZiAobXNnSWR4ICE9PSAtMSkgewogICAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5JdGVtcy5zcGxpY2UobXNnSWR4LCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBtc2dfZWRpdE1lc3NhZ2U6IGZ1bmN0aW9uIG1zZ19lZGl0TWVzc2FnZShfcmVmMzcsIF9yZWYzOCkgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjM3LmNvbW1pdCwKICAgICAgICAgIHN0YXRlID0gX3JlZjM3LnN0YXRlOwogICAgICB2YXIgQ2hhdElkID0gX3JlZjM4LkNoYXRJZCwKICAgICAgICAgIE1lc3NhZ2UgPSBfcmVmMzguTWVzc2FnZTsKICAgICAgTWVzc2FnZS5DaGF0SWQgPSBDaGF0SWQ7CiAgICAgIE1lc3NhZ2UuVGltZSAqPSAxMDAwOwogICAgICBjb21taXQoJ21zZ19jYWNoZU1lc3NhZ2UnLCBNZXNzYWdlKTsKCiAgICAgIGlmIChzdGF0ZS5tZXNzZW5nZXJEYXRhLkN1cnJlbnRDaGF0LklkID09PSBDaGF0SWQpIHsKICAgICAgICB2YXIgbXNnSWR4ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5JdGVtcy5maW5kSW5kZXgoZnVuY3Rpb24gKG0pIHsKICAgICAgICAgIHJldHVybiBtLklkID09PSBNZXNzYWdlLklkOwogICAgICAgIH0pOwoKICAgICAgICBpZiAobXNnSWR4ICE9PSAtMSkgewogICAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5JdGVtcy5zcGxpY2UobXNnSWR4LCAxKTsKICAgICAgICAgIHN0YXRlLm1lc3NlbmdlckRhdGEuQ3VycmVudENoYXQuSXRlbXMucHVzaChNZXNzYWdlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBtc2dfZGVsZXRlQ2hhdDogZnVuY3Rpb24gbXNnX2RlbGV0ZUNoYXQoX3JlZjM5LCBjaGF0SWQpIHsKICAgICAgdmFyIHN0YXRlID0gX3JlZjM5LnN0YXRlLAogICAgICAgICAgY29tbWl0ID0gX3JlZjM5LmNvbW1pdDsKICAgICAgY29tbWl0KCdtc2dfcmVtb3ZlQ2hhdCcsIGNoYXRJZCk7CgogICAgICBpZiAoc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5JZCA9PT0gY2hhdElkKSB7CiAgICAgICAgY29tbWl0KCdzbWFydHBob25lL3NldEN1cnJlbnRUYWInLCB7CiAgICAgICAgICBrZXk6ICdNZXNzZW5nZXJUYWInLAogICAgICAgICAgc2VjdGlvbjogJ0dlbmVyYWxTZWN0aW9uJywKICAgICAgICAgIHN1YnNlY3Rpb246ICdHZW5lcmFsU3Vic2VjdGlvbicsCiAgICAgICAgICBkYXRhOiBudWxsCiAgICAgICAgfSwgewogICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgbXNnX3NldEluQ2hhdEJsb2NrZWQ6IGZ1bmN0aW9uIG1zZ19zZXRJbkNoYXRCbG9ja2VkKF9yZWY0MCwgX3JlZjQxKSB7CiAgICAgIHZhciBzdGF0ZSA9IF9yZWY0MC5zdGF0ZSwKICAgICAgICAgIGRpc3BhdGNoID0gX3JlZjQwLmRpc3BhdGNoOwogICAgICB2YXIgQ2hhdElkID0gX3JlZjQxLkNoYXRJZCwKICAgICAgICAgIElzQmxvY2tlZCA9IF9yZWY0MS5Jc0Jsb2NrZWQ7CgogICAgICBpZiAoc3RhdGUubWVzc2VuZ2VyRGF0YS5DdXJyZW50Q2hhdC5JZCA9PT0gQ2hhdElkKSB7CiAgICAgICAgZGlzcGF0Y2goJ3NtYXJ0cGhvbmUvbXNnX2dvVG9DaGF0cycsIHRydWUsIHsKICAgICAgICAgIHJvb3Q6IHRydWUKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKElzQmxvY2tlZCkgewogICAgICAgIHZhciBjaGF0SWR4ID0gc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5maW5kSW5kZXgoZnVuY3Rpb24gKGMpIHsKICAgICAgICAgIHJldHVybiBjLklkID09PSBDaGF0SWQ7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjaGF0SWR4ICE9PSAtMSkgewogICAgICAgICAgc3RhdGUubWVzc2VuZ2VyRGF0YS5DaGF0cy5zcGxpY2UoY2hhdElkeCwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9Ow=="},null]}